---
import Next from "src/icons/Next.astro";
import SendResponse from "src/icons/Send.astro";

const information = [
  {
    title: "sena-1",
    href: "/signals/sena_1.GIF",
    response: "bienvenidos",
  },
  {
    title: "sena-2",
    href: "/signals/sena_2.GIF",
    response: "con mucho gusto",
  },
  {
    title: "sena-3",
    href: "/signals/sena_3.GIF",
    response: "como esta",
  },
  {
    title: "sena-4",
    href: "/signals/sena_4.GIF",
    response: "felicitaciones",
  },
  {
    title: "sena-5",
    href: "/signals/sena_5.GIF",
    response: "excelente",
  },
];

//Random number for different signals about information array
const randomIndex = Math.floor(Math.random() * information.length);
const randomItem = information[randomIndex];
---

<section class="max-w-5xl mx-auto w-full px-4 py-8">
  <div
    class="bg-background-blue p-6 rounded-3xl flex flex-col justify-center items-center gap-4"
  >
    <h1 class="text-black/70 font-semibold text-2xl text-center">
      Â¿QuÃ© significa esta seÃ±a?
    </h1>

    <div class="bg-white rounded-3xl p-4 w-full">
      <form id="signalForm">
        <div class="grid place-content-center mb-6">
          {
            (
              <div class="p-4 rounded-2xl w-full lg:h-[450px]">
                <img
                  src={randomItem.href}
                  alt={randomItem.title}
                  class="h-full max-w-full object-contain mx-auto"
                />
              </div>
            )
          }
        </div>
        <div class="mb-6">
          <input
            id="responseInput"
            placeholder="Digite la traduccion de la seÃ±a"
            class="w-full p-4 border-b border-gray-300 focus:outline-none text-gray-600"
          />
        </div>
        <button
          type="submit"
          class="text-lg font-semibold bg-blue hover:saturate-150 transition text-white
          rounded-full px-4 py-2 inline-flex gap-x-2 justify-center items-center w-full mb-4"
        >
          <SendResponse />
          Adivinar
        </button>
        <button
          id="nextItem"
          type="button"
          class="text-lg font-semibold bg-gray-500 hover:saturate-150 transition text-white
          rounded-full px-4 py-2 inline-flex gap-x-2 justify-center items-center w-full"
        >
          <Next />
          Siguiente seÃ±a
        </button>
      </form>
      <div
        id="containerMessage"
        class="hidden w-full bg-amber-100 rounded-md p-6 my-4"
      >
        <p id="resultMessage" class="text-center font-semibold text-2xl"></p>
      </div>
      <span id="hiddenResponse" class="hidden">{randomItem.response}</span>
    </div>
  </div>
</section>

<script>
  const form = document.getElementById("signalForm");
  const inputValue = document.getElementById("responseInput") as any;
  const resultMessage = document.getElementById("resultMessage") as any;
  const containerMessage = document.getElementById("containerMessage") as any;
  const hiddenResponse = document
    .getElementById("hiddenResponse")
    ?.textContent?.trim()
    .toLowerCase();

  form?.addEventListener("submit", function (event) {
    event.preventDefault();

    const valueResponse = inputValue.value.trim().toLowerCase();

    if (valueResponse == hiddenResponse) {
      resultMessage.textContent = "Â¡Correcto! La respuesta es correcta ðŸ˜Š.";
      resultMessage.classList.add("text-green-700");
      resultMessage.classList.remove("text-red-700");

      showMessageAndClearInput();

      setTimeout(() => {
        location.reload();
      }, 3000);
    } else {
      resultMessage.textContent = "Â¡Incorrecto! Intenta de nuevo ðŸ˜ž.";
      resultMessage.classList.add("text-red-700");
      resultMessage.classList.remove("text-green-700");

      showMessageAndClearInput();
    }
  });

  //function to show message and clean input
  const showMessageAndClearInput = () => {
    containerMessage.classList.remove("hidden");
    inputValue.value = "";
  };

  const nextButton = document.getElementById("nextItem") as HTMLButtonElement;

  nextButton?.addEventListener("click", () => {
    window.location.reload();
  });
</script>
